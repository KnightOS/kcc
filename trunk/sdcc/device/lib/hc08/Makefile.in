# libc/hc08 Makefile

VPATH  = @srcdir@
srcdir = @srcdir@
top_builddir = @top_builddir@

LIB_TYPE     = @LIB_TYPE@

TOPDIR = ../../..

SCC = $(TOPDIR)/bin/sdcc -mhc08
SAS = $(TOPDIR)/bin/as6808

PORTDIR = ../build/hc08

OBJ = _ret.rel _divuint.rel _divulong.rel _mulint.rel _mullong.rel

LIB = hc08.lib
CC = $(SCC)
AS = $(SAS)
ASFLAGS = -plosgff

CFLAGS = -I$(srcdir)/../../include -I. --std-c99

all: $(PORTDIR)/$(LIB)

$(PORTDIR)/$(LIB): $(OBJ) Makefile _dummy
ifeq ($(LIB_TYPE), SDCCLIB)
	rm -f $@; \
	../../../bin/sdcclib -a $@ $(OBJ)
else ifeq ($(LIB_TYPE), AR)
	ar -Scq $@ $(OBJ)
else ifeq ($(LIB_TYPE), RANLIB)
	ar -Scq $@ $(OBJ)
	$(top_builddir)/bin/asranlib $@
else
	rm -f $@
	for i in $(basename $(OBJ)); do echo $$i >>$@; done
	cp $(OBJ) $(PORTDIR)
endif

%.rel: %.c
	$(CC) $(CFLAGS) -c $<

%.rel: %.asm
	$(AS) $(ASFLAGS) $@ $<

_dummy:

clean:
	rm -f *.rel *.sym *.lst *~ $(CLEANSPEC) *.dump* *.asm *.lib

distclean: clean
	rm -f Makefile
